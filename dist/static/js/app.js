"use strict";function _init(){$.AdminLTE.layout={activate:function(){var e=this;e.fix(),e.fixSidebar(),$(window,".wrapper").resize(function(){e.fix(),e.fixSidebar()})},fix:function(){var e=$(".main-header").outerHeight()+$(".main-footer").outerHeight(),t=$(window).height(),i=$(".sidebar").height();$("body").hasClass("fixed")?$(".content-wrapper, .right-side").css("min-height",t-$(".main-footer").outerHeight()):t>=i?$(".content-wrapper, .right-side").css("min-height",t-e):$(".content-wrapper, .right-side").css("min-height",i)},fixSidebar:function(){return $("body").hasClass("fixed")?("undefined"==typeof $.fn.slimScroll&&console&&console.error("Error: the fixed layout requires the slimscroll plugin!"),void($.AdminLTE.options.sidebarSlimScroll&&"undefined"!=typeof $.fn.slimScroll&&($(".sidebar").slimScroll({destroy:!0}).height("auto"),$(".sidebar").slimscroll({height:$(window).height()-$(".main-header").height()+"px",color:"rgba(0,0,0,0.2)",size:"3px"})))):void("undefined"!=typeof $.fn.slimScroll&&$(".sidebar").slimScroll({destroy:!0}).height("auto"))}},$.AdminLTE.pushMenu=function(e){var t=this.options.screenSizes;$(e).click(function(e){e.preventDefault(),$(window).width()>t.sm-1?$("body").toggleClass("sidebar-collapse"):$("body").hasClass("sidebar-open")?($("body").removeClass("sidebar-open"),$("body").removeClass("sidebar-collapse")):$("body").addClass("sidebar-open")}),$(".content-wrapper").click(function(){$(window).width()<=t.sm-1&&$("body").hasClass("sidebar-open")&&$("body").removeClass("sidebar-open")})},$.AdminLTE.tree=function(e){var t=this;$("li a",$(e)).click(function(e){var i=$(this),n=i.next();if(n.is(".treeview-menu")&&n.is(":visible"))n.slideUp("normal",function(){n.removeClass("menu-open")}),n.parent("li").removeClass("active");else if(n.is(".treeview-menu")&&!n.is(":visible")){var a=i.parents("ul").first(),o=a.find("ul:visible").slideUp("normal");o.removeClass("menu-open");var s=i.parent("li");n.slideDown("normal",function(){n.addClass("menu-open"),a.find("li.active").removeClass("active"),s.addClass("active"),t.layout.fix()})}n.is(".treeview-menu")&&e.preventDefault()})},$.AdminLTE.boxWidget={activate:function(){var e=$.AdminLTE.options,t=this;$(e.boxWidgetOptions.boxWidgetSelectors.collapse).click(function(e){e.preventDefault(),t.collapse($(this))}),$(e.boxWidgetOptions.boxWidgetSelectors.remove).click(function(e){e.preventDefault(),t.remove($(this))})},collapse:function(e){var t=e.parents(".box").first(),i=t.find(".box-body, .box-footer");t.hasClass("collapsed-box")?(e.children(".fa-plus").removeClass("fa-plus").addClass("fa-minus"),i.slideDown(300,function(){t.removeClass("collapsed-box")})):(e.children(".fa-minus").removeClass("fa-minus").addClass("fa-plus"),i.slideUp(300,function(){t.addClass("collapsed-box")}))},remove:function(e){var t=e.parents(".box").first();t.slideUp()},options:$.AdminLTE.options.boxWidgetOptions}}if("undefined"==typeof jQuery)throw new Error("AdminLTE requires jQuery");$.AdminLTE={},$.AdminLTE.options={navbarMenuSlimscroll:!0,navbarMenuSlimscrollWidth:"3px",navbarMenuHeight:"200px",sidebarToggleSelector:"[data-toggle='offcanvas']",sidebarPushMenu:!0,sidebarSlimScroll:!0,enableBoxRefresh:!0,enableBSToppltip:!0,BSTooltipSelector:"[data-toggle='tooltip']",enableFastclick:!0,enableBoxWidget:!0,boxWidgetOptions:{boxWidgetIcons:{collapse:"fa fa-minus",open:"fa fa-plus",remove:"fa fa-times"},boxWidgetSelectors:{remove:'[data-widget="remove"]',collapse:'[data-widget="collapse"]'}},directChat:{enable:!0,contactToggleSelector:'[data-widget="chat-pane-toggle"]'},colors:{lightBlue:"#3c8dbc",red:"#f56954",green:"#00a65a",aqua:"#00c0ef",yellow:"#f39c12",blue:"#0073b7",navy:"#001F3F",teal:"#39CCCC",olive:"#3D9970",lime:"#01FF70",orange:"#FF851B",fuchsia:"#F012BE",purple:"#8E24AA",maroon:"#D81B60",black:"#222222",gray:"#d2d6de"},screenSizes:{xs:480,sm:768,md:992,lg:1200}},$(function(){var e=$.AdminLTE.options;_init(),$.AdminLTE.layout.activate(),$.AdminLTE.tree(".sidebar"),e.navbarMenuSlimscroll&&"undefined"!=typeof $.fn.slimscroll&&$(".navbar .menu").slimscroll({height:"200px",alwaysVisible:!1,size:"3px"}).css("width","100%"),e.sidebarPushMenu&&$.AdminLTE.pushMenu(e.sidebarToggleSelector),e.enableBSToppltip&&$(e.BSTooltipSelector).tooltip(),e.enableBoxWidget&&$.AdminLTE.boxWidget.activate(),e.enableFastclick&&"undefined"!=typeof FastClick&&FastClick.attach(document.body),e.directChat.enable&&$(e.directChat.contactToggleSelector).click(function(){var e=$(this).parents(".direct-chat").first();e.toggleClass("direct-chat-contacts-open")}),$('.btn-group[data-toggle="btn-toggle"]').each(function(){var e=$(this);$(this).find(".btn").click(function(t){e.find(".btn.active").removeClass("active"),$(this).addClass("active"),t.preventDefault()})})}),function(e){e.fn.boxRefresh=function(t){function i(e){e.append(o),a.onLoadStart.call(e)}function n(e){e.find(o).remove(),a.onLoadDone.call(e)}var a=e.extend({trigger:".refresh-btn",source:"",onLoadStart:function(e){},onLoadDone:function(e){}},t),o=e('<div class="overlay"><div class="fa fa-refresh fa-spin"></div></div>');return this.each(function(){if(""===a.source)return void(console&&console.log("Please specify a source first - boxRefresh()"));var t=e(this),o=t.find(a.trigger).first();o.click(function(e){e.preventDefault(),i(t),t.find(".box-body").load(a.source,function(){n(t)})})})}}(jQuery),function(e){e.fn.todolist=function(t){var i=e.extend({onCheck:function(e){},onUncheck:function(e){}},t);return this.each(function(){"undefined"!=typeof e.fn.iCheck?(e("input",this).on("ifChecked",function(t){var n=e(this).parents("li").first();n.toggleClass("done"),i.onCheck.call(n)}),e("input",this).on("ifUnchecked",function(t){var n=e(this).parents("li").first();n.toggleClass("done"),i.onUncheck.call(n)})):e("input",this).on("change",function(t){var n=e(this).parents("li").first();n.toggleClass("done"),i.onCheck.call(n)})})}}(jQuery),function(){if("function"!=typeof $.fn.twbsPagination)throw new Error("twbsPagination required");var e={first:"第一页",prev:"上一页",next:"下一页",last:"最后一页",paginationClass:"pagination pagination-sm no-margin pull-right"};$.extend($.fn.twbsPagination.defaults,e)}();var App={module:{},page:{},route:function(){var e,t,i=this.module,n=this.page,a=location.pathname,o=/^\/(\w+)\/$/,s=/^\/(\w+)\/(\d+)\/$/,l=null;switch(!0){case"/"===a:e="dashboard";break;case o.test(a):l=o.exec(a),e=l[1];break;case s.test(a):l=s.exec(a),e=l[1],t=+l[2]}return"login"===e?n.login(i):(i.search(),i.menu(a,e),void 0===t?n[e](i,a,e):n[e+"Detail"](i,a,e,t))}};App.module.login=function(){var e=document.forms.login,t=e.action,i=e.elements,n=i.username,a=i.password,o=i[2],s=$(e).find("p"),l=function(){o.disabled=!(n.value&&a.value)},r=function(i){i.preventDefault(),$.post(t,$(e).serialize(),function(e){e.status?location.href=location.search?location.search.substr(1).split("=")[1]:"/":(s.text("用户名或密码错误！"),o.disabled=!0,a.value="")})};$(e).keyup(l).submit(r)},App.module.register=function(){var e=document.forms.add,t=e.action,i=e.elements,n=i.username,a=i.password,o=i.retype,s=i[3],l=$(e).find("p"),r=function(){s.disabled=!(n.value&&a.value&&o.value)},c=function(e){e.preventDefault();var i=function(e){e.status?location.reload():l.text("抱歉，添加失败！").show()};a.value===o.value?$.post(t,$([n,a]).serialize(),i):(l.text("两次输入密码不一致！").show(),s.disabled=!0,a.value="",o.value="")};$(e).keyup(r).submit(c)},App.module.admin=function(){var e=$(".user-admin"),t=e.find("input"),i=e.find("button"),n=i.eq(0),a=i.eq(1),o=[],s=function(e,i){e.click(function(){o.length=0,t.filter(":checked").each(function(e,t){o.push($(t).parent().next().data("id"))}),o.length&&$.post(i,{id:o.toString()},function(e){e.status&&location.reload()})})};s(n,"/api/user/reset/"),s(a,"/api/user/remove/")},App.module.settings=function(){var e=document.forms.info,t=e.action,i=e.elements,n=i.username,a=i.oldPassword,o=i.newPassword,s=i.retype,l=i[4],r=$(e).find("p"),c=function(){l.disabled=!(n.value&&a.value&&o.value&&s.value)},d=function(e){e.preventDefault();var i=function(e){e.status?(r.text("更新成功！").show(),location.href="/login/"):(r.text("原密码错误！").show(),a.value="",o.value="",s.value="")};o.value===s.value?$.post(t,$([n,a,o]).serialize(),i):(r.text("两次输入密码不一致！").show(),o.value="",s.value="")};$(e).keyup(c).submit(d)},App.module.line=function(e){$.getJSON("/api/line"+e,function(e){echarts.init($("#line-chart")[0],"macarons").setOption({color:["#00a65a","#00c0ef","#dd4b39"],tooltip:{trigger:"axis"},legend:{data:["正面","中性","负面"]},grid:{x:40,y:30,x2:25,y2:30},xAxis:[{type:"category",boundaryGap:!1,data:e.date}],yAxis:[{type:"value"}],series:[{name:"正面",type:"line",data:e.positive},{name:"中性",type:"line",data:e.neutral},{name:"负面",type:"line",data:e.negative}]})})},App.module.pie=function(e){$.getJSON("/api/pie"+e,function(e){echarts.init($("#pie-chart")[0],"macarons").setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{data:e.name},series:[{name:"信息比例",type:"pie",radius:"55%",center:["50%","60%"],data:e.value}]})})},App.module.search=function(){var e=document.forms.search,t=e.elements.keywords;$(e).submit(function(i){i.preventDefault();var n=$.trim(t.value);n&&(e.reset(),location.href="/search/"+n+"/")})},App.module.menu=function(e,t){var i=$(".sidebar-menu"),n=i.parent(),a=function(){var i=this.getAttribute("href");switch(!0){case"dashboard"===t:return"/"===i;case"category"===t:case"location"===t:return i===e;default:return i.split("/")[1]===t}};i.detach().find("a").filter(a).parent().addClass("active").closest(".treeview-menu").addClass("menu-open").closest(".treeview").addClass("active"),i.appendTo(n)},App.module.infoBox=function(){var e=function(e,t){var i,n=$(t).find(".info-box-number"),a=$(t).find(".progress-bar"),o=$(t).find(".progress-description"),s=2e3,l=100,r=Math.floor(s/l),c=0,d=0,u=$(t).data("number"),p=Math.floor(u/r),f=0,h=$(t).data("percent"),g=Math.floor(h/r),m=function(){d+=p,f+=g,c++,c>=r&&(clearInterval(i),d=u,f=h),n.text(d.toFixed()),a.width(f+"%"),o.text("占总数据 "+f.toFixed()+"%")};i=setInterval(m,l)};$(".info-box-content").each(e)},App.module.inspection=function(){var e=$("#inspection"),t=e.children(".box-body").find("tbody");t.load("/api/dashboard/local-inspection/"),e.on("click","button",function(e){return e.preventDefault(),$(this).hasClass("active")?!1:($(this).addClass("active").siblings().removeClass("active"),void t.load("/api/dashboard/"+this.id+"/"))})},App.module.returnTop=function(e){var t=e.offset().top,i=t>160?t-120:0;$("body").animate({scrollTop:i})},App.module.table=function(e,t){$(".table-custom").each(function(){var i=$(this),n=i.parent(),a=this.tBodies[0],o=this.id,s=function(e){var t=e.data,i=$.map(t,function(e){var t="/"+o+"/"+e.id+"/",i='<td><a href="'+t+'" title="'+e.title+'" target="_blank">'+e.title+"</a></td>",n="<td>"+e.source+"</td>",a="<td>"+e.location+"</td>",s="<td>"+e.time+"</td>",l='<td class="text-center">'+e.hot+"</td>",r="<tr>"+i+n+a+s+l+"</tr>";return r});$(a).html(i)};$.getJSON("/api"+t+o+"/1/",function(a){s(a),n.twbsPagination({totalPages:a.total,visiblePages:7,onPageClick:function(a,l){e.returnTop(i),$.getJSON("/api"+t+o+"/"+l+"/",function(e){s(e),n.twbsPagination({totalPages:e.total})})}})})})},App.module.collect=function(e,t){$(".collection").click(function(){var i=$(this).find("i"),n=$(this).find("span"),a=function(a,o){var s={type:"news"===e?"article":"topic",id:t};$.post(a,s,function(e){e.status&&(i.toggleClass("fa-star-o"),i.toggleClass("fa-star"),n.text(o))})};i.hasClass("fa-star")?a("/api/collection/remove/","添加收藏"):a("/api/collection/add/","取消收藏")})},App.module.sns=function(e,t,i){var n=$(".sns");n.each(function(a,o){var s=$(o),l=s.parent().next(),r=function(){return"weixin"===i||"weibo"===i?l.data("type"):l.data("type").replace("-","/")};$.getJSON("/api"+t+r()+"/1/",function(i){s.html(i.html),l.twbsPagination({totalPages:i.total,onPageClick:function(i,a){e.returnTop(n),$.getJSON("/api"+t+r()+"/"+a+"/",function(e){s.html(e.html),l.twbsPagination({totalPages:e.total})})}})})})},App.module.dataTable=function(e){$.fn.dataTable.ext.errMode="throw",$(".initDataTable").each(function(){var t=$(this).DataTable({ajax:{url:"/api"+e,dataSrc:this.id,cache:!0},autoWidth:!1,pageLength:25,order:[],language:{processing:"处理中...",search:"",searchPlaceholder:"输入关键字过滤...",lengthMenu:"显示 _MENU_ 条",info:"显示第 _START_ 至 _END_ 条，共 _TOTAL_ 条",infoEmpty:"信息空",infoFiltered:"(由 _MAX_ 项结果过滤)",infoPostFix:"",loadingRecords:"载入中...",zeroRecords:"无匹配结果",emptyTable:"无结果",paginate:{first:"第一页",previous:"上一页",next:"下一页",last:"最后一页"},aria:{sortAscending:"正序排列",sortDescending:"倒序排列"}},deferLoading:100,drawCallback:function(){$('[data-toggle="tooltip"]').tooltip()}});t.on("click","tbody > tr",function(){$(this).hasClass("selected")?$(this).removeClass("selected"):(t.$("tr.selected").removeClass("selected"),$(this).addClass("selected"))})})},App.module.custom=function(){var e=document.forms.addKeyword,t=e.action,i=e.elements,n=i[0],a=i[1],o=i[2],s=$(e).prev(),l=$(e).parent().prev().find("li"),r=function(){o.disabled=!a.value},c=function(i){i.preventDefault(),$.post(t,$(e).serialize(),function(e){e.status?(s.text("关键词添加成功！").show(),location.reload()):(s.text("关键词添加失败！").show(),a.value="")})};l.length>=5?n.disabled=!0:$(e).keyup(r).submit(c)},App.page.login=function(e){e.login()},App.page.settings=function(e){e.settings()},App.page.user=function(e){e.admin(),e.register()},App.page.dashboard=function(e,t){e.infoBox(),e.line(t),e.pie(t),e.inspection()},App.page.news=function(e,t){e.table(e,t)},App.page.newsDetail=function(e,t,i,n){e.collect(i,n)},App.page.event=function(e,t){e.table(e,t)},App.page.eventDetail=function(e,t,i,n){e.collect(i,n),e.line(t,i),e.pie(t,i),e.table(e,t),e.sns(e,t,i)},App.page.weixin=function(e,t,i){e.sns(e,t,i)},App.page.weixinDetail=function(){},App.page.weibo=function(e,t,i){e.sns(e,t,i)},App.page.categoryDetail=function(e,t){e.table(e,t)},App.page.locationDetail=function(e,t,i){e.table(e,t),e.sns(e,t,i)},App.page.inspection=function(e,t){e.dataTable(t)},App.page.custom=function(e){e.custom()},App.page.customDetail=function(e,t,i){e.table(e,t),e.sns(e,t,i)},App.page.collection=function(e,t){e.table(e,t)},$(function(){App.route()});